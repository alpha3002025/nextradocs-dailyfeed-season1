# 모듈 구성 원칙
<br/>

- no common ➝ 서브모듈로 공유
- data 모듈 구성 자제
- 수직계열화 방지

<br/>
<br/>

# no common ➝ 서브모듈로 공유
프로젝트 시작 시 염두에 둔 내용중 하나는 'common 모듈을 사용하지 말자'였습니다. 그리고 이번 'dailyfeed'프로젝트에서는 `common` 모듈에 중복되는 기능을 관리하는 대신 필요한 기능이 어떤 모듈에 속할지를 정의해서 서브 모듈로 분리했습니다. 개발 초창기에 무언가를 빠르게 개발할때는 `common`모듈은 편합니다. 하지만, 나중에 관리를 할때 분리하기 힘들어지고 분리가 힘든 변명을 찾았던 현업에서의 경험이 떠올랐기에, 처음부터 `common` 모듈은 `금지`했습니다.<br/>
<br/>

common 모듈에 작성해야 했던 내용들은 다음의 서브모듈들로 분리해서 개별정의해서 사용했습니다.<br/>

- dailyfeed-code
- dailyfeed-redis-support
- dailyfeed-kafka-support
- dailyfeed-pagination-support
- dailyfeed-deadletter-support
<br/>

`common` 모듈을 프로젝트에 도입하지 않은 이유들은 다음과 같습니다.
- 성능측면 : 너무 많은 코드 들의 집약으로 인해, `common` 모듈을 사용하게 될 신규 서비스의 리소스 역시 과다하게 소모되는 단점
- 관리의 불편함 : 개발의 '편리함'을 위해 `common`모듈을 사용하게 되면, 나중에는 `common`의 변경사항이 모든 서비스에 전이되어 관리가 어려워질 수 있다는 단점
- 결합도로 인한 불편함 : common 모듈에 대한 결합도가 높아져서, API 명세의 변경까지도 common 모델의 변경으로 전이되는 경우 역시 존재
- 사고방식의 경색 : '지나친 공통화에 대한 욕심', '어리석은 똑똑함' 과 같은 사고방식으로 발전하고 common 이 만능으로 생각된다는 단점

<br/>
<br/>

# data 모듈 구성 자제
이번 프로젝트에서는 쿼리 (JPA, SQL, Querydsl)들은 전체 서비스의 data 모듈에 모아두지 않았습니다. 쿼리를 공통화하면 처음에는 정말 편하지만 나중으로 가면 갈수록 이 쿼리가 다른 서비스에서 쓰는지 아닌지에 대한 확신이 점점 없어지며, 레거시 쿼리들이 점점 함정처럼 느껴지기 시작하는 것 같다는 생각을 했습니다. 쿼리는 `member`, `content`, `timeline`, `image` 등에서 별도로 자율성을 부여해서 사용하는 것이 좋다고 생각하고 있고 필요하다면 서비스 별 중첩구조의 data 모듈을 서브모듈로 만드는 것은 추천할수 있겠지만, 전체 서비스의 data 모듈을 정의하는 것은 배제했습니다.<br/>

예를 들어 현재 `dailyfeed-content-svc`, `dailyfeed-timeline-svc` 프로젝트에서 `Post`, `Comment` 라는 도메인은  `dailyfeed-content-svc`, `dailyfeed-timeline-svc`  서비스 각각에서 서로 다른 쿼리 (JPA, SQL, Querydsl)로 사용되며, 각각의 서비스 내의 쿼리는 독립적이며, 서로 코드레벨에서 영향을 주지 않습니다. 즉, `dailyfeed-content-svc` 입장에서는 Post,Comment 의 작업은 독립성을 가지고 쿼리를 구성하고, `dailyfeed-timeline-svc` 입장에서도 `Post`, `Comment` 의 작업을 독립성을 가지고 쿼리를 구성하도록 했습니다.<br/>

 구현을 편하게 하고 빠르게 하려면, 쿼리(JPA, SQL, Querydsl)를 한 곳에 모아뒀겠지만, 서비스별로 독립성을 부여하기 위해 이렇게 각각 별도로 구체 쿼리들을 개별 서비스들이 보유하도록 구성했습니다.<br/>
 <br/>


# '라이브러리'의 수직계열화 방지
'수직계열화' 라는 말이 조금 생소하게 들릴 수 있습니다. 이번 프로젝트에서 '특정 라이브러리, 어떤 라이브러리를 사용한다는 것을 특정 모듈에 고정해서 규격화' 하는 것을 '수직계열화' 라는 단어로 사용했습니다. 어떤 라이브러리, 어떤 버전의 라이브러리의 선택을 규격화해서 지나치게 중첩화해서 분류해두는 것은 각 서비스 별 자율성을 떨어뜨린다고 판단해서 '라이브러리의 수직계열화'는 지양했습니다. 즉, 라이브러리의 선택은 각 서비스 별로 자율적으로 선택할 수 있도록 했습니다.<br/>

예를 들어 JWT 분해 로직을 여러 모듈에 공유하고 싶다고 해서, `dailyfeed-code` 에 넣어서 공통화하지 않았습니다. JWT 라이브러리를 사용한 JWT 분해 로직은 `member-service`만 필요하게끔 서비스의 경계를 구성했고, JWT 생성/분해 로직을 외부로 노출시키지 않았기에 불필요하게 공통 로직을 만들지는 않았습니다. 만약 module 또는 서비스 간 JWT 생성/분해 로직에 대한 공유가 필요했다면 `dailyfeed-jwt-support` 라는 모듈로 분리했을 것입니다.<br/>
<br/>

